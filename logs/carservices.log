2025-11-29T08:01:47.342+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=10h17m41s107ms472Âµs400ns).
2025-11-29T09:03:14.255+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=11m51s661ms278Âµs500ns).
2025-11-29T11:30:10.937+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=19m24s396ms774Âµs100ns).
2025-11-29T12:47:13.422+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=27m50s840ms681Âµs).
2025-11-29T12:48:17.719+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=1m14s991ms648Âµs500ns).
2025-11-29T15:41:43.907+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T15:41:43.886+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T15:41:43.907+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T15:41:44.219+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764416504219 | took 144ms | statement | connection 1029| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T15:41:44.219+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764416504219 | took 139ms | statement | connection 1031| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T15:41:44.219+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764416504219 | took 139ms | statement | connection 1030| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T15:41:44.424+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764416504424 | took 9ms | statement | connection 1030| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T15:41:44.426+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764416504426 | took 12ms | statement | connection 1031| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T15:41:44.469+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T15:41:44.470+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T15:41:44.471+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-9] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T15:41:44.495+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764416504495 | took 20ms | statement | connection 1034| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T15:41:44.501+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764416504501 | took 27ms | statement | connection 1033| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T15:41:44.505+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764416504505 | took 29ms | statement | connection 1032| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T15:41:44.579+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764416504579 | took 1ms | commit | connection 1034| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T15:41:44.585+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764416504585 | took 0ms | commit | connection 1032| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T15:41:44.583+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764416504583 | took 4ms | commit | connection 1033| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T15:42:06.815+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    SELECT
        spr.sparepartsrequest_id          AS sparePartsRequestId,
        spr.date                          AS date,
        b.branch_name                     AS branchName,
        b.address                         AS address,
        b.city                            AS city,
        spr.vin_number                    AS vin,
        sp.spareparts_type                AS sparepartsType,
        bbsp.state                        AS state,
        sprd.spare_part                   AS sparePart,
        sprd.class_type                   AS classType,
        sprd.qty                          AS qty,
        sprd.price                        AS price,
        c.manager_mobile                  AS managerMobile,
        bbsp.id                           AS id,
        spr.request_status                AS requestStatus,
        sprd.id                           AS detailId,
        br.brand_id                       AS brandId,
        br.brand_name                     AS brandName 
    FROM
        spare_parts_request spr 
    JOIN
        spare_parts             sp   
            ON sp.spareparts_id = spr.spareparts_id 
    JOIN
        branch_brand_spare_part bbsp 
            ON bbsp.branch_id = spr.branch_id 
    JOIN
        branch                  b    
            ON b.branch_id     = bbsp.branch_id 
    JOIN
        company                 c    
            ON c.company_id    = b.company_id 
    JOIN
        spare_parts_request_details sprd 
            ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id 
    JOIN
        brand                   br   
            ON br.brand_id     = bbsp.brand_id 
    WHERE
        b.branch_id = ? 
    ORDER BY
        spr.date DESC,
        b.branch_name ASC 
2025-11-29T15:42:06.819+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [1]
2025-11-29T15:42:06.849+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764416526849 | took 29ms | statement | connection 1029| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = ?
ORDER BY spr.date DESC, b.branch_name ASC

SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = 1
ORDER BY spr.date DESC, b.branch_name ASC
;
