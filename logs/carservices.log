2025-12-15T07:10:43.259+04:00  WARN 33472 --- [carservices] [HikariPool-1 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=9h4m58s327ms164µs100ns).
2025-12-15T07:25:41.749+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-2] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-12-15T07:25:41.872+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1765769141872 | took 72ms | statement | connection 222| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT plate_number
  FROM car_details
 WHERE user_id = ?
 ORDER BY plate_number

SELECT plate_number
  FROM car_details
 WHERE user_id = 25
 ORDER BY plate_number
;
2025-12-15T07:25:41.891+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1765769141891 | took 94ms | statement | connection 226| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-12-15T07:25:41.974+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-5] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-12-15T07:25:41.974+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-7] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-12-15T07:25:41.974+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-9] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-12-15T07:25:41.991+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1765769141991 | took 14ms | statement | connection 225| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-12-15T07:25:41.991+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1765769141991 | took 14ms | statement | connection 223| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-12-15T07:25:41.993+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1765769141993 | took 19ms | statement | connection 224| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-12-15T07:25:42.020+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1765769142020 | took 1ms | commit | connection 224| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-12-15T07:25:42.020+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1765769142020 | took 0ms | commit | connection 225| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-12-15T07:25:42.020+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1765769142020 | took 1ms | commit | connection 223| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-12-15T07:53:55.084+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-4] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":67}
2025-12-15T07:53:55.084+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-9] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":67}
2025-12-15T07:53:56.026+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1765770836026 | took 528ms | statement | connection 232| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = ?

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = 67

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-12-15T07:53:56.029+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1765770836029 | took 523ms | statement | connection 233| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = ?

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = 67

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-12-15T07:53:56.176+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1765770836176 | took 26ms | statement | connection 233| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (100)
ORDER BY rss.reservation_service_sparepart_id
;
2025-12-15T07:53:56.180+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1765770836180 | took 31ms | statement | connection 232| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (100)
ORDER BY rss.reservation_service_sparepart_id
;
2025-12-15T10:11:04.412+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    select
        ur1_0.id,
        ur1_0.birthday,
        ur1_0.email,
        ur1_0.full_name,
        ur1_0.gender,
        ur1_0.mobile,
        ur1_0.password 
    from
        user_registration ur1_0 
    where
        upper(ur1_0.email)=upper(?) 
    fetch
        first ? rows only
2025-12-15T10:11:04.484+04:00 TRACE 33472 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (1:VARCHAR) <- [kashusays1@gmail.com]
2025-12-15T10:11:04.489+04:00 TRACE 33472 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (2:INTEGER) <- [1]
2025-12-15T10:11:04.566+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1765779064566 | took 65ms | statement | connection 282| url jdbc:p6spy:postgresql://localhost:5433/testdb
select ur1_0.id,ur1_0.birthday,ur1_0.email,ur1_0.full_name,ur1_0.gender,ur1_0.mobile,ur1_0.password from user_registration ur1_0 where upper(ur1_0.email)=upper(?) fetch first ? rows only
select ur1_0.id,ur1_0.birthday,ur1_0.email,ur1_0.full_name,ur1_0.gender,ur1_0.mobile,ur1_0.password from user_registration ur1_0 where upper(ur1_0.email)=upper('kashusays1@gmail.com') fetch first 1 rows only;
2025-12-15T11:25:12.865+04:00  WARN 33472 --- [carservices] [HikariPool-1 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=25m44s237ms384µs200ns).
2025-12-15T11:41:54.084+04:00  WARN 33472 --- [carservices] [HikariPool-1 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=13m5s377ms128µs600ns).
2025-12-15T12:37:36.611+04:00  WARN 33472 --- [carservices] [HikariPool-1 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=18m41s434ms171µs100ns).
2025-12-15T14:54:06.731+04:00  WARN 33472 --- [carservices] [HikariPool-1 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2h16m35s544ms584µs500ns).
2025-12-15T15:01:41.298+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-7] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-12-15T15:01:41.534+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1765796501533 | took 143ms | statement | connection 333| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,     -- ✔ FIXED MODEL NAME
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.user_id = ?

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,     -- ✔ FIXED MODEL NAME
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.user_id = 1

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-12-15T15:01:41.583+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1765796501583 | took 10ms | statement | connection 333| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,90,88,1,5)
ORDER BY rss.reservation_service_sparepart_id
;
2025-12-15T15:04:46.932+04:00  WARN 33472 --- [carservices] [HikariPool-1 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1m38s791ms134µs600ns).
2025-12-15T15:17:30.718+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-12-15T15:17:30.792+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1765797450792 | took 55ms | statement | connection 336| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT plate_number
  FROM car_details
 WHERE user_id = ?
 ORDER BY plate_number

SELECT plate_number
  FROM car_details
 WHERE user_id = 25
 ORDER BY plate_number
;
2025-12-15T15:17:30.816+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1765797450816 | took 63ms | statement | connection 337| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-12-15T15:17:30.881+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-12-15T15:17:30.881+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-12-15T15:17:30.881+04:00 DEBUG 33472 --- [carservices] [http-nio-8081-exec-5] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-12-15T15:17:30.893+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1765797450893 | took 10ms | statement | connection 333| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-12-15T15:17:30.899+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1765797450899 | took 16ms | statement | connection 334| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-12-15T15:17:30.902+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1765797450901 | took 19ms | statement | connection 335| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-12-15T15:17:30.916+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1765797450916 | took 1ms | commit | connection 335| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-12-15T15:17:30.916+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1765797450916 | took 1ms | commit | connection 334| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-12-15T15:17:30.916+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1765797450916 | took 1ms | commit | connection 333| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-12-15T15:18:00.701+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-3] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":67}
2025-12-15T15:18:00.701+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-10] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":67}
2025-12-15T15:18:00.764+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1765797480764 | took 42ms | statement | connection 333| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = ?

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = 67

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-12-15T15:18:00.832+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1765797480832 | took 111ms | statement | connection 336| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = ?

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,

    b.branch_name              AS branch_name,
    b.branch_address           AS address,       -- ✔ FIXED HERE
    b.city                     AS city,
    b.logo_img                 AS logo_img,

    br.brand_name              AS brand_name,
    m.model_name               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,

    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,

    COALESCE(AVG(re.stars), 0) AS stars

FROM reservation_service_request r

JOIN branch b
  ON b.branch_id = r.branch_id

LEFT JOIN car_details cd
  ON cd.car_id = r.car_id

JOIN brand br
  ON br.brand_id = r.brand_id

LEFT JOIN car_brand_model m
  ON m.id = r.model_id

JOIN service_entity s
  ON s.service_id = r.service_id

LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = r.brand_id

LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id

WHERE r.branch_id = 67

GROUP BY
    r.user_id,
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.branch_address, b.city, b.logo_img,
    br.brand_name, m.model_name, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number

ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-12-15T15:18:00.839+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1765797480839 | took 4ms | statement | connection 333| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (100)
ORDER BY rss.reservation_service_sparepart_id
;
2025-12-15T15:18:00.855+04:00  INFO 33472 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1765797480855 | took 17ms | statement | connection 336| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
    rss.reservation_service_sparepart_id,
    rss.part_name,
    rss.qty,
    rss.spareparts_id,
    sp.spareparts_type,
    rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (100)
ORDER BY rss.reservation_service_sparepart_id
;
2025-12-15T18:34:49.273+04:00  WARN 33472 --- [carservices] [HikariPool-1 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2h8m28s954ms410µs600ns).
