2025-11-29T08:01:47.342+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=10h17m41s107ms472Âµs400ns).
2025-11-29T09:03:14.255+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=11m51s661ms278Âµs500ns).
2025-11-29T11:30:10.937+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=19m24s396ms774Âµs100ns).
2025-11-29T12:47:13.422+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=27m50s840ms681Âµs).
2025-11-29T12:48:17.719+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=1m14s991ms648Âµs500ns).
2025-11-29T15:41:43.907+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T15:41:43.886+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T15:41:43.907+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T15:41:44.219+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764416504219 | took 144ms | statement | connection 1029| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T15:41:44.219+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764416504219 | took 139ms | statement | connection 1031| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T15:41:44.219+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764416504219 | took 139ms | statement | connection 1030| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T15:41:44.424+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764416504424 | took 9ms | statement | connection 1030| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T15:41:44.426+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764416504426 | took 12ms | statement | connection 1031| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T15:41:44.469+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T15:41:44.470+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T15:41:44.471+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-9] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T15:41:44.495+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764416504495 | took 20ms | statement | connection 1034| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T15:41:44.501+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764416504501 | took 27ms | statement | connection 1033| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T15:41:44.505+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764416504505 | took 29ms | statement | connection 1032| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T15:41:44.579+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764416504579 | took 1ms | commit | connection 1034| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T15:41:44.585+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764416504585 | took 0ms | commit | connection 1032| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T15:41:44.583+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764416504583 | took 4ms | commit | connection 1033| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T15:42:06.815+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    SELECT
        spr.sparepartsrequest_id          AS sparePartsRequestId,
        spr.date                          AS date,
        b.branch_name                     AS branchName,
        b.address                         AS address,
        b.city                            AS city,
        spr.vin_number                    AS vin,
        sp.spareparts_type                AS sparepartsType,
        bbsp.state                        AS state,
        sprd.spare_part                   AS sparePart,
        sprd.class_type                   AS classType,
        sprd.qty                          AS qty,
        sprd.price                        AS price,
        c.manager_mobile                  AS managerMobile,
        bbsp.id                           AS id,
        spr.request_status                AS requestStatus,
        sprd.id                           AS detailId,
        br.brand_id                       AS brandId,
        br.brand_name                     AS brandName 
    FROM
        spare_parts_request spr 
    JOIN
        spare_parts             sp   
            ON sp.spareparts_id = spr.spareparts_id 
    JOIN
        branch_brand_spare_part bbsp 
            ON bbsp.branch_id = spr.branch_id 
    JOIN
        branch                  b    
            ON b.branch_id     = bbsp.branch_id 
    JOIN
        company                 c    
            ON c.company_id    = b.company_id 
    JOIN
        spare_parts_request_details sprd 
            ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id 
    JOIN
        brand                   br   
            ON br.brand_id     = bbsp.brand_id 
    WHERE
        b.branch_id = ? 
    ORDER BY
        spr.date DESC,
        b.branch_name ASC 
2025-11-29T15:42:06.819+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [1]
2025-11-29T15:42:06.849+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764416526849 | took 29ms | statement | connection 1029| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = ?
ORDER BY spr.date DESC, b.branch_name ASC

SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = 1
ORDER BY spr.date DESC, b.branch_name ASC
;
2025-11-29T16:33:59.674+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:33:59.674+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:33:59.912+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764419639911 | took 119ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:33:59.912+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764419639911 | took 119ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:33:59.954+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764419639954 | took 11ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:33:59.954+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764419639954 | took 10ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:34:27.934+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:34:27.934+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:34:27.951+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764419667951 | took 8ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:34:27.951+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764419667951 | took 8ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:34:27.959+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764419667959 | took 1ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:34:27.960+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764419667960 | took 1ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:35:17.388+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:35:17.390+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:35:17.396+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764419717396 | took 4ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:35:17.396+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764419717396 | took 4ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:35:17.403+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764419717403 | took 1ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:35:17.403+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764419717403 | took 1ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:35:27.760+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:35:27.757+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:35:27.768+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764419727768 | took 6ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:35:27.769+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764419727769 | took 6ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:35:27.774+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:35:27.779+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764419727779 | took 1ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:35:27.783+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764419727783 | took 1ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:35:27.830+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764419727830 | took 40ms | statement | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:35:27.840+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764419727840 | took 7ms | statement | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:38:39.476+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T16:38:39.657+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764419919657 | took 126ms | statement | connection 1052| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T16:38:39.818+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-7] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T16:38:39.818+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-3] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T16:38:39.818+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-5] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T16:38:39.833+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764419919833 | took 11ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T16:38:39.835+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764419919835 | took 12ms | statement | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T16:38:39.841+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764419919841 | took 20ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T16:38:39.888+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764419919888 | took 2ms | commit | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:38:39.889+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764419919889 | took 2ms | commit | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:38:39.889+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764419919888 | took 1ms | commit | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:39:32.851+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    select
        ur1_0.id,
        ur1_0.birthday,
        ur1_0.email,
        ur1_0.full_name,
        ur1_0.gender,
        ur1_0.mobile,
        ur1_0.password 
    from
        user_registration ur1_0 
    where
        upper(ur1_0.email)=upper(?) 
    fetch
        first ? rows only
2025-11-29T16:39:32.860+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.orm.jdbc.bind              : binding parameter (1:VARCHAR) <- [branch@example.com]
2025-11-29T16:39:32.863+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.orm.jdbc.bind              : binding parameter (2:INTEGER) <- [1]
2025-11-29T16:39:32.902+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764419972902 | took 30ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
select ur1_0.id,ur1_0.birthday,ur1_0.email,ur1_0.full_name,ur1_0.gender,ur1_0.mobile,ur1_0.password from user_registration ur1_0 where upper(ur1_0.email)=upper(?) fetch first ? rows only
select ur1_0.id,ur1_0.birthday,ur1_0.email,ur1_0.full_name,ur1_0.gender,ur1_0.mobile,ur1_0.password from user_registration ur1_0 where upper(ur1_0.email)=upper('branch@example.com') fetch first 1 rows only;
2025-11-29T16:39:36.996+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-9] org.hibernate.SQL                        : 
    select
        b1_0.branch_id,
        b1_0.address,
        b1_0.branch_address,
        b1_0.branch_code,
        b1_0.branch_cover_img,
        b1_0.branch_manager_name,
        b1_0.branch_manager_surname,
        b1_0.branch_name,
        b1_0.city,
        b1_0.company_id,
        b1_0.latitude,
        b1_0.location,
        b1_0.login_email,
        b1_0.logo_img,
        b1_0.longitude,
        b1_0.mobile,
        b1_0.password,
        b1_0.status 
    from
        branch b1_0 
    where
        upper(b1_0.login_email)=upper(?) 
    fetch
        first ? rows only
2025-11-29T16:39:36.999+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-9] org.hibernate.orm.jdbc.bind              : binding parameter (1:VARCHAR) <- [branch@example.com]
2025-11-29T16:39:37.000+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-9] org.hibernate.orm.jdbc.bind              : binding parameter (2:INTEGER) <- [1]
2025-11-29T16:39:37.004+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764419977004 | took 3ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.branch_id,b1_0.address,b1_0.branch_address,b1_0.branch_code,b1_0.branch_cover_img,b1_0.branch_manager_name,b1_0.branch_manager_surname,b1_0.branch_name,b1_0.city,b1_0.company_id,b1_0.latitude,b1_0.location,b1_0.login_email,b1_0.logo_img,b1_0.longitude,b1_0.mobile,b1_0.password,b1_0.status from branch b1_0 where upper(b1_0.login_email)=upper(?) fetch first ? rows only
select b1_0.branch_id,b1_0.address,b1_0.branch_address,b1_0.branch_code,b1_0.branch_cover_img,b1_0.branch_manager_name,b1_0.branch_manager_surname,b1_0.branch_name,b1_0.city,b1_0.company_id,b1_0.latitude,b1_0.location,b1_0.login_email,b1_0.logo_img,b1_0.longitude,b1_0.mobile,b1_0.password,b1_0.status from branch b1_0 where upper(b1_0.login_email)=upper('branch@example.com') fetch first 1 rows only;
2025-11-29T16:39:42.068+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T16:39:42.094+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T16:39:42.097+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764419982097 | took 4ms | statement | connection 1052| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T16:39:42.094+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T16:39:42.099+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T16:39:42.106+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764419982106 | took 1ms | statement | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T16:39:42.118+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764419982118 | took 0ms | commit | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:39:42.124+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764419982124 | took 1ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T16:39:42.139+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764419982139 | took 1ms | commit | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:39:42.142+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764419982142 | took 18ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T16:39:42.199+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764419982199 | took 1ms | commit | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:40:15.888+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:40:15.888+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T16:40:15.921+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764420015921 | took 24ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:40:15.921+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764420015921 | took 24ms | statement | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T16:40:15.934+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764420015934 | took 2ms | statement | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:40:15.934+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764420015934 | took 2ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T16:40:34.793+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T16:40:34.793+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-7] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T16:40:34.795+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764420034795 | took 1ms | statement | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T16:40:34.797+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764420034797 | took 3ms | statement | connection 1052| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T16:40:34.799+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764420034799 | took 0ms | commit | connection 1051| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:40:34.801+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764420034801 | took 0ms | commit | connection 1052| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:40:34.818+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T16:40:34.821+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-3] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T16:40:34.823+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764420034823 | took 1ms | statement | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T16:40:34.827+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764420034825 | took 6ms | statement | connection 1052| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T16:40:34.830+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764420034830 | took 0ms | commit | connection 1052| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:40:34.830+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764420034830 | took 0ms | commit | connection 1049| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T16:40:34.904+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-5] org.hibernate.SQL                        : 
    select
        cbm1_0.id,
        cbm1_0.brand_id,
        cbm1_0.model_name 
    from
        car_brand_model cbm1_0 
    left join
        brand b1_0 
            on b1_0.brand_id=cbm1_0.brand_id 
    where
        b1_0.brand_id=? 
    order by
        cbm1_0.model_name
2025-11-29T16:40:34.906+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-5] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [0]
2025-11-29T16:40:34.923+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764420034923 | took 17ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
select cbm1_0.id,cbm1_0.brand_id,cbm1_0.model_name from car_brand_model cbm1_0 left join brand b1_0 on b1_0.brand_id=cbm1_0.brand_id where b1_0.brand_id=? order by cbm1_0.model_name
select cbm1_0.id,cbm1_0.brand_id,cbm1_0.model_name from car_brand_model cbm1_0 left join brand b1_0 on b1_0.brand_id=cbm1_0.brand_id where b1_0.brand_id=0 order by cbm1_0.model_name;
2025-11-29T16:40:34.973+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    select
        cbm1_0.id,
        cbm1_0.brand_id,
        cbm1_0.model_name 
    from
        car_brand_model cbm1_0 
    left join
        brand b1_0 
            on b1_0.brand_id=cbm1_0.brand_id 
    where
        b1_0.brand_id=? 
    order by
        cbm1_0.model_name
2025-11-29T16:40:34.979+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [0]
2025-11-29T16:40:34.982+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764420034982 | took 1ms | statement | connection 1050| url jdbc:p6spy:postgresql://localhost:5433/testdb
select cbm1_0.id,cbm1_0.brand_id,cbm1_0.model_name from car_brand_model cbm1_0 left join brand b1_0 on b1_0.brand_id=cbm1_0.brand_id where b1_0.brand_id=? order by cbm1_0.model_name
select cbm1_0.id,cbm1_0.brand_id,cbm1_0.model_name from car_brand_model cbm1_0 left join brand b1_0 on b1_0.brand_id=cbm1_0.brand_id where b1_0.brand_id=0 order by cbm1_0.model_name;
2025-11-29T18:17:34.744+04:00  WARN 9392 --- [carservices] [HikariPool-10 housekeeper] com.zaxxer.hikari.pool.HikariPool        : HikariPool-10 - Thread starvation or clock leap detected (housekeeper delta=49m12s35ms914Âµs700ns).
2025-11-29T18:40:26.113+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T18:40:26.113+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T18:40:26.280+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764427226280 | took 90ms | statement | connection 1080| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T18:40:26.280+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764427226280 | took 90ms | statement | connection 1079| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T18:40:26.321+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764427226321 | took 12ms | statement | connection 1079| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T18:40:26.321+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764427226321 | took 12ms | statement | connection 1080| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T18:41:33.717+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T18:41:33.720+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T18:41:33.722+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764427293722 | took 3ms | statement | connection 1079| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T18:41:33.725+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764427293725 | took 3ms | statement | connection 1080| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T18:41:33.726+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764427293725 | took 1ms | statement | connection 1079| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T18:41:33.728+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764427293728 | took 1ms | statement | connection 1080| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:07:00.956+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    SELECT
        spr.sparepartsrequest_id          AS sparePartsRequestId,
        spr.date                          AS date,
        b.branch_name                     AS branchName,
        b.address                         AS address,
        b.city                            AS city,
        spr.vin_number                    AS vin,
        sp.spareparts_type                AS sparepartsType,
        bbsp.state                        AS state,
        sprd.spare_part                   AS sparePart,
        sprd.class_type                   AS classType,
        sprd.qty                          AS qty,
        sprd.price                        AS price,
        c.manager_mobile                  AS managerMobile,
        bbsp.id                           AS id,
        spr.request_status                AS requestStatus,
        sprd.id                           AS detailId,
        br.brand_id                       AS brandId,
        br.brand_name                     AS brandName 
    FROM
        spare_parts_request spr 
    JOIN
        spare_parts             sp   
            ON sp.spareparts_id = spr.spareparts_id 
    JOIN
        branch_brand_spare_part bbsp 
            ON bbsp.branch_id = spr.branch_id 
    JOIN
        branch                  b    
            ON b.branch_id     = bbsp.branch_id 
    JOIN
        company                 c    
            ON c.company_id    = b.company_id 
    JOIN
        spare_parts_request_details sprd 
            ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id 
    JOIN
        brand                   br   
            ON br.brand_id     = bbsp.brand_id 
    WHERE
        b.branch_id = ? 
    ORDER BY
        spr.date DESC,
        b.branch_name ASC 
2025-11-29T19:07:01.008+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [1]
2025-11-29T19:07:01.085+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764428821083 | took 70ms | statement | connection 1089| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = ?
ORDER BY spr.date DESC, b.branch_name ASC

SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = 1
ORDER BY spr.date DESC, b.branch_name ASC
;
2025-11-29T19:07:14.719+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-2] org.hibernate.SQL                        : 
    SELECT
        spr.sparepartsrequest_id          AS sparePartsRequestId,
        spr.date                          AS date,
        b.branch_name                     AS branchName,
        b.address                         AS address,
        b.city                            AS city,
        spr.vin_number                    AS vin,
        sp.spareparts_type                AS sparepartsType,
        bbsp.state                        AS state,
        sprd.spare_part                   AS sparePart,
        sprd.class_type                   AS classType,
        sprd.qty                          AS qty,
        sprd.price                        AS price,
        c.manager_mobile                  AS managerMobile,
        bbsp.id                           AS id,
        spr.request_status                AS requestStatus,
        sprd.id                           AS detailId,
        br.brand_id                       AS brandId,
        br.brand_name                     AS brandName 
    FROM
        spare_parts_request spr 
    JOIN
        spare_parts             sp   
            ON sp.spareparts_id = spr.spareparts_id 
    JOIN
        branch_brand_spare_part bbsp 
            ON bbsp.branch_id = spr.branch_id 
    JOIN
        branch                  b    
            ON b.branch_id     = bbsp.branch_id 
    JOIN
        company                 c    
            ON c.company_id    = b.company_id 
    JOIN
        spare_parts_request_details sprd 
            ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id 
    JOIN
        brand                   br   
            ON br.brand_id     = bbsp.brand_id 
    WHERE
        b.branch_id = ? 
    ORDER BY
        spr.date DESC,
        b.branch_name ASC 
2025-11-29T19:07:14.721+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-2] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [1]
2025-11-29T19:07:14.723+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764428834723 | took 2ms | statement | connection 1089| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = ?
ORDER BY spr.date DESC, b.branch_name ASC

SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = 1
ORDER BY spr.date DESC, b.branch_name ASC
;
2025-11-29T19:15:09.505+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:15:09.505+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:15:09.637+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764429309637 | took 71ms | statement | connection 1089| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:15:09.637+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764429309637 | took 71ms | statement | connection 1090| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:15:09.663+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764429309663 | took 7ms | statement | connection 1089| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:15:09.665+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764429309665 | took 7ms | statement | connection 1090| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:25:57.208+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:25:57.208+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:25:57.353+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764429957353 | took 107ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:25:57.353+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764429957353 | took 107ms | statement | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:25:57.387+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764429957387 | took 5ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:25:57.387+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764429957387 | took 8ms | statement | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:26:06.527+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.SQL                        : 
    select
        rsr1_0.reservation_id,
        rsr1_0.brand_id,
        rsr1_0.car_id,
        rsr1_0.model_id,
        rsr1_0.reservation_date,
        rsr1_0.reservation_status,
        rsr1_0.reservation_time,
        rsr1_0.service_id,
        rsr1_0.user_id 
    from
        reservation_service_request rsr1_0 
    where
        rsr1_0.reservation_id=?
2025-11-29T19:26:06.530+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [87]
2025-11-29T19:26:06.565+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764429966565 | took 32ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=?
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=87;
2025-11-29T19:26:06.631+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764429966631 | took 4ms | commit | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:26:06.814+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.SQL                        : 
    update
        reservation_service_request 
    set
        brand_id=?,
        car_id=?,
        model_id=?,
        reservation_date=?,
        reservation_status=?,
        reservation_time=?,
        service_id=?,
        user_id=? 
    where
        reservation_id=?
2025-11-29T19:26:06.817+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [null]
2025-11-29T19:26:06.818+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (2:BIGINT) <- [null]
2025-11-29T19:26:06.818+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (3:BIGINT) <- [null]
2025-11-29T19:26:06.819+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (4:DATE) <- [2025-11-29]
2025-11-29T19:26:06.821+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (5:VARCHAR) <- [cancelled]
2025-11-29T19:26:06.822+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (6:TIME) <- [10:00]
2025-11-29T19:26:06.822+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (7:BIGINT) <- [null]
2025-11-29T19:26:06.822+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (8:BIGINT) <- [1]
2025-11-29T19:26:06.822+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (9:BIGINT) <- [87]
2025-11-29T19:26:06.843+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764429966843 | took 13ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
update reservation_service_request set brand_id=?,car_id=?,model_id=?,reservation_date=?,reservation_status=?,reservation_time=?,service_id=?,user_id=? where reservation_id=?
update reservation_service_request set brand_id=NULL,car_id=NULL,model_id=NULL,reservation_date='2025-11-29T00:00:00.000+0400',reservation_status='cancelled',reservation_time='1970-01-01T10:00:00.000+0400',service_id=NULL,user_id=1 where reservation_id=87;
2025-11-29T19:26:06.867+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764429966867 | took 11ms | commit | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:26:06.930+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:26:06.933+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764429966933 | took 2ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:26:06.938+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764429966938 | took 0ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:26:16.389+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:26:16.395+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764429976395 | took 4ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:26:16.401+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764429976401 | took 1ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:26:16.406+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:26:16.411+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764429976411 | took 2ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:26:16.414+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764429976414 | took 1ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:27:51.443+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:27:51.443+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:27:51.454+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764430071454 | took 5ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:27:51.454+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764430071454 | took 5ms | statement | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:27:51.477+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764430071477 | took 1ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:27:51.477+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764430071477 | took 1ms | statement | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,88,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:28:34.366+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    select
        rsr1_0.reservation_id,
        rsr1_0.brand_id,
        rsr1_0.car_id,
        rsr1_0.model_id,
        rsr1_0.reservation_date,
        rsr1_0.reservation_status,
        rsr1_0.reservation_time,
        rsr1_0.service_id,
        rsr1_0.user_id 
    from
        reservation_service_request rsr1_0 
    where
        rsr1_0.reservation_id=?
2025-11-29T19:28:34.368+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [88]
2025-11-29T19:28:34.371+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764430114371 | took 2ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=?
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=88;
2025-11-29T19:28:34.375+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764430114375 | took 0ms | commit | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:28:34.394+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    update
        reservation_service_request 
    set
        brand_id=?,
        car_id=?,
        model_id=?,
        reservation_date=?,
        reservation_status=?,
        reservation_time=?,
        service_id=?,
        user_id=? 
    where
        reservation_id=?
2025-11-29T19:28:34.395+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [null]
2025-11-29T19:28:34.395+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (2:BIGINT) <- [null]
2025-11-29T19:28:34.395+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (3:BIGINT) <- [null]
2025-11-29T19:28:34.395+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (4:DATE) <- [2025-11-29]
2025-11-29T19:28:34.396+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (5:VARCHAR) <- [cancelled]
2025-11-29T19:28:34.397+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (6:TIME) <- [09:00]
2025-11-29T19:28:34.397+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (7:BIGINT) <- [null]
2025-11-29T19:28:34.397+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (8:BIGINT) <- [1]
2025-11-29T19:28:34.397+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.orm.jdbc.bind              : binding parameter (9:BIGINT) <- [88]
2025-11-29T19:28:34.403+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764430114403 | took 2ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
update reservation_service_request set brand_id=?,car_id=?,model_id=?,reservation_date=?,reservation_status=?,reservation_time=?,service_id=?,user_id=? where reservation_id=?
update reservation_service_request set brand_id=NULL,car_id=NULL,model_id=NULL,reservation_date='2025-11-29T00:00:00.000+0400',reservation_status='cancelled',reservation_time='1970-01-01T09:00:00.000+0400',service_id=NULL,user_id=1 where reservation_id=88;
2025-11-29T19:28:34.406+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764430114406 | took 0ms | commit | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:28:34.422+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T19:28:34.425+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764430114425 | took 2ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:28:34.428+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764430114428 | took 2ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:30:54.124+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.SQL                        : 
    SELECT
        spr.sparepartsrequest_id          AS sparePartsRequestId,
        spr.date                          AS date,
        b.branch_name                     AS branchName,
        b.address                         AS address,
        b.city                            AS city,
        spr.vin_number                    AS vin,
        sp.spareparts_type                AS sparepartsType,
        bbsp.state                        AS state,
        sprd.spare_part                   AS sparePart,
        sprd.class_type                   AS classType,
        sprd.qty                          AS qty,
        sprd.price                        AS price,
        c.manager_mobile                  AS managerMobile,
        bbsp.id                           AS id,
        spr.request_status                AS requestStatus,
        sprd.id                           AS detailId,
        br.brand_id                       AS brandId,
        br.brand_name                     AS brandName 
    FROM
        spare_parts_request spr 
    JOIN
        spare_parts             sp   
            ON sp.spareparts_id = spr.spareparts_id 
    JOIN
        branch_brand_spare_part bbsp 
            ON bbsp.branch_id = spr.branch_id 
    JOIN
        branch                  b    
            ON b.branch_id     = bbsp.branch_id 
    JOIN
        company                 c    
            ON c.company_id    = b.company_id 
    JOIN
        spare_parts_request_details sprd 
            ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id 
    JOIN
        brand                   br   
            ON br.brand_id     = bbsp.brand_id 
    WHERE
        b.branch_id = ? 
    ORDER BY
        spr.date DESC,
        b.branch_name ASC 
2025-11-29T19:30:54.125+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [1]
2025-11-29T19:30:54.149+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764430254149 | took 23ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = ?
ORDER BY spr.date DESC, b.branch_name ASC

SELECT
    spr.sparepartsrequest_id          AS sparePartsRequestId,
    spr.date                          AS date,
    b.branch_name                     AS branchName,
    b.address                         AS address,
    b.city                            AS city,
    spr.vin_number                    AS vin,
    sp.spareparts_type                AS sparepartsType,
    bbsp.state                        AS state,
    sprd.spare_part                   AS sparePart,
    sprd.class_type                   AS classType,
    sprd.qty                          AS qty,
    sprd.price                        AS price,
    c.manager_mobile                  AS managerMobile,
    bbsp.id                           AS id,
    spr.request_status                AS requestStatus,
    sprd.id                           AS detailId,
    br.brand_id                       AS brandId,
    br.brand_name                     AS brandName
FROM spare_parts_request spr
JOIN spare_parts             sp   ON sp.spareparts_id = spr.spareparts_id
JOIN branch_brand_spare_part bbsp ON bbsp.branch_id = spr.branch_id
JOIN branch                  b    ON b.branch_id     = bbsp.branch_id
JOIN company                 c    ON c.company_id    = b.company_id
JOIN spare_parts_request_details sprd ON sprd.sparepartsrequest_id = spr.sparepartsrequest_id
JOIN brand                   br   ON br.brand_id     = bbsp.brand_id
WHERE b.branch_id = 1
ORDER BY spr.date DESC, b.branch_name ASC
;
2025-11-29T19:31:06.296+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-2] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T19:31:06.324+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764430266324 | took 18ms | statement | connection 1102| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T19:31:06.335+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-7] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T19:31:06.335+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T19:31:06.335+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-9] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T19:31:06.339+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764430266339 | took 2ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T19:31:06.339+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764430266339 | took 2ms | statement | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T19:31:06.341+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764430266341 | took 5ms | statement | connection 1101| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T19:31:06.343+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764430266343 | took 0ms | commit | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:31:06.344+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-9] p6spy                                    : #1764430266344 | took 0ms | commit | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:31:06.344+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764430266344 | took 0ms | commit | connection 1101| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:31:17.044+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T19:31:17.048+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T19:31:17.048+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764430277048 | took 1ms | statement | connection 1102| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T19:31:17.048+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-3] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T19:31:17.048+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T19:31:17.050+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764430277050 | took 0ms | statement | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T19:31:17.053+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-3] p6spy                                    : #1764430277053 | took 0ms | commit | connection 1099| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:31:17.053+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764430277053 | took 3ms | statement | connection 1101| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T19:31:17.056+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764430277056 | took 0ms | commit | connection 1101| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:31:17.056+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764430277056 | took 7ms | statement | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T19:31:17.058+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764430277058 | took 0ms | commit | connection 1100| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:57:46.372+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T19:57:46.564+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764431866563 | took 90ms | statement | connection 1112| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T19:57:46.587+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T19:57:46.587+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T19:57:46.587+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-2] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T19:57:46.597+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764431866597 | took 9ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T19:57:46.598+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764431866598 | took 6ms | statement | connection 1111| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T19:57:46.598+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764431866598 | took 6ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T19:57:46.613+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764431866613 | took 1ms | commit | connection 1111| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:57:46.613+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764431866613 | took 1ms | commit | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:57:46.613+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764431866613 | took 1ms | commit | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:58:15.519+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-5] org.hibernate.SQL                        : 
    select
        ur1_0.id,
        ur1_0.birthday,
        ur1_0.email,
        ur1_0.full_name,
        ur1_0.gender,
        ur1_0.mobile,
        ur1_0.password 
    from
        user_registration ur1_0 
    where
        upper(ur1_0.email)=upper(?) 
    fetch
        first ? rows only
2025-11-29T19:58:15.522+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-5] org.hibernate.orm.jdbc.bind              : binding parameter (1:VARCHAR) <- [user@example.com]
2025-11-29T19:58:15.523+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-5] org.hibernate.orm.jdbc.bind              : binding parameter (2:INTEGER) <- [1]
2025-11-29T19:58:15.540+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764431895540 | took 13ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
select ur1_0.id,ur1_0.birthday,ur1_0.email,ur1_0.full_name,ur1_0.gender,ur1_0.mobile,ur1_0.password from user_registration ur1_0 where upper(ur1_0.email)=upper(?) fetch first ? rows only
select ur1_0.id,ur1_0.birthday,ur1_0.email,ur1_0.full_name,ur1_0.gender,ur1_0.mobile,ur1_0.password from user_registration ur1_0 where upper(ur1_0.email)=upper('user@example.com') fetch first 1 rows only;
2025-11-29T19:58:17.479+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-10] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T19:58:17.480+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-2] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T19:58:17.481+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-7] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T19:58:17.484+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T19:58:17.505+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764431897505 | took 0ms | statement | connection 1111| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T19:58:17.500+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764431897500 | took 3ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T19:58:17.505+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764431897505 | took 3ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T19:58:17.512+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764431897512 | took 0ms | commit | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:58:17.511+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764431897511 | took 1ms | statement | connection 1112| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T19:58:17.513+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764431897513 | took 0ms | commit | connection 1111| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:58:17.513+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-10] p6spy                                    : #1764431897513 | took 1ms | commit | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T19:58:17.591+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764431897591 | took 6ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT plate_number
  FROM car_details
 WHERE user_id = ?
 ORDER BY plate_number

SELECT plate_number
  FROM car_details
 WHERE user_id = 1
 ORDER BY plate_number
;
2025-11-29T19:58:26.800+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-11-29T19:58:26.829+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764431906829 | took 27ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:58:26.848+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-5] p6spy                                    : #1764431906848 | took 8ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:59:26.018+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-11-29T19:59:26.024+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764431966024 | took 4ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:59:26.027+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764431966027 | took 1ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T19:59:35.992+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-11-29T19:59:36.023+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764431976023 | took 24ms | statement | connection 1111| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T19:59:36.033+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764431976033 | took 4ms | statement | connection 1111| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T20:04:05.321+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-11-29T20:04:05.403+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764432245403 | took 48ms | statement | connection 1112| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T20:04:05.423+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764432245423 | took 8ms | statement | connection 1112| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T20:05:36.013+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-11-29T20:05:36.149+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764432336149 | took 90ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T20:05:36.174+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764432336174 | took 7ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T20:12:00.226+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T20:12:00.227+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-branch body: {"branch_id":1}
2025-11-29T20:12:00.334+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764432720334 | took 54ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T20:12:00.334+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764432720334 | took 54ms | statement | connection 1112| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.branch_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T20:12:00.349+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764432720349 | took 2ms | statement | connection 1112| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T20:12:00.349+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764432720349 | took 2ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T20:12:04.705+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-11-29T20:12:04.740+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764432724740 | took 17ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T20:12:04.745+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764432724745 | took 2ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T20:13:08.378+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] c.c.c.c.ReservationQueryController       : POST /api/reservations/by-user body: {"userId":1}
2025-11-29T20:13:08.385+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764432788385 | took 5ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = ?
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC

SELECT
    r.user_id                  AS user_id,                 -- ðŸ”¹ NEW
    r.reservation_id           AS reservation_id,
    r.reservation_date         AS reservation_date,
    r.reservation_time         AS reservation_time,
    b.branch_name              AS branch_name,
    b.address                  AS address,
    b.city                     AS city,
    b.logo_img                 AS logo_img,
    br.brand_name              AS brand_name,
    cd.car_model               AS model_name,
    s.service_name             AS service_name,
    r.reservation_status       AS reservation_status,
    bbs.id                     AS branch_brand_serviceid,
    cd.plate_number            AS plate_number,
    COALESCE(AVG(re.stars), 0) AS stars
FROM reservation_service_request r
JOIN branch b ON b.branch_id = r.branch_id
JOIN car_details cd ON cd.car_id = r.car_id
JOIN brand br ON br.brand_id = cd.brand_id
JOIN service_entity s ON s.service_id = r.service_id
LEFT JOIN branch_brand_service bbs
  ON bbs.branch_id = r.branch_id
 AND bbs.service_id = r.service_id
 AND bbs.brand_id   = cd.brand_id
LEFT JOIN rate_experience re
  ON re.branch_brand_serviceid = bbs.id
WHERE r.user_id = 1
GROUP BY
    r.user_id,                                           -- ðŸ”¹ NEW
    r.reservation_id, r.reservation_date, r.reservation_time,
    b.branch_name, b.address, b.city, b.logo_img,
    br.brand_name, cd.car_model, s.service_name,
    r.reservation_status, bbs.id, cd.plate_number
ORDER BY r.reservation_date DESC, r.reservation_time DESC
;
2025-11-29T20:13:08.386+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764432788386 | took 0ms | statement | connection 1110| url jdbc:p6spy:postgresql://localhost:5433/testdb
SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (?,?,?,?,?)
ORDER BY rss.reservation_service_sparepart_id

SELECT
  rss.reservation_service_sparepart_id,
  rss.part_name,
  rss.qty,
  rss.spareparts_id,
  sp.spareparts_type,
  rss.reservation_id
FROM reservation_service_sparepart rss
LEFT JOIN spare_parts sp
  ON sp.spareparts_id = rss.spareparts_id
WHERE rss.reservation_id IN (89,87,90,5,1)
ORDER BY rss.reservation_service_sparepart_id
;
2025-11-29T20:13:36.160+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    select
        rsr1_0.reservation_id,
        rsr1_0.brand_id,
        rsr1_0.car_id,
        rsr1_0.model_id,
        rsr1_0.reservation_date,
        rsr1_0.reservation_status,
        rsr1_0.reservation_time,
        rsr1_0.service_id,
        rsr1_0.user_id 
    from
        reservation_service_request rsr1_0 
    where
        rsr1_0.reservation_id=?
2025-11-29T20:13:36.163+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [90]
2025-11-29T20:13:36.171+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764432816171 | took 7ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=?
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=90;
2025-11-29T20:13:36.191+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764432816191 | took 1ms | commit | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T20:13:36.265+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.SQL                        : 
    update
        reservation_service_request 
    set
        brand_id=?,
        car_id=?,
        model_id=?,
        reservation_date=?,
        reservation_status=?,
        reservation_time=?,
        service_id=?,
        user_id=? 
    where
        reservation_id=?
2025-11-29T20:13:36.270+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [null]
2025-11-29T20:13:36.270+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (2:BIGINT) <- [null]
2025-11-29T20:13:36.270+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (3:BIGINT) <- [null]
2025-11-29T20:13:36.271+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (4:DATE) <- [2025-11-29]
2025-11-29T20:13:36.273+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (5:VARCHAR) <- [canceled]
2025-11-29T20:13:36.273+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (6:TIME) <- [09:00]
2025-11-29T20:13:36.273+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (7:BIGINT) <- [null]
2025-11-29T20:13:36.273+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (8:BIGINT) <- [1]
2025-11-29T20:13:36.273+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-8] org.hibernate.orm.jdbc.bind              : binding parameter (9:BIGINT) <- [90]
2025-11-29T20:13:36.308+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764432816308 | took 22ms | statement | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb
update reservation_service_request set brand_id=?,car_id=?,model_id=?,reservation_date=?,reservation_status=?,reservation_time=?,service_id=?,user_id=? where reservation_id=?
update reservation_service_request set brand_id=NULL,car_id=NULL,model_id=NULL,reservation_date='2025-11-29T00:00:00.000+0400',reservation_status='canceled',reservation_time='1970-01-01T09:00:00.000+0400',service_id=NULL,user_id=1 where reservation_id=90;
2025-11-29T20:13:36.313+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-8] p6spy                                    : #1764432816313 | took 3ms | commit | connection 1109| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T20:18:33.916+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    select
        rsr1_0.reservation_id,
        rsr1_0.brand_id,
        rsr1_0.car_id,
        rsr1_0.model_id,
        rsr1_0.reservation_date,
        rsr1_0.reservation_status,
        rsr1_0.reservation_time,
        rsr1_0.service_id,
        rsr1_0.user_id 
    from
        reservation_service_request rsr1_0 
    where
        rsr1_0.reservation_id=?
2025-11-29T20:18:33.926+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [5]
2025-11-29T20:18:33.979+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764433113979 | took 50ms | statement | connection 1119| url jdbc:p6spy:postgresql://localhost:5433/testdb
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=?
select rsr1_0.reservation_id,rsr1_0.brand_id,rsr1_0.car_id,rsr1_0.model_id,rsr1_0.reservation_date,rsr1_0.reservation_status,rsr1_0.reservation_time,rsr1_0.service_id,rsr1_0.user_id from reservation_service_request rsr1_0 where rsr1_0.reservation_id=5;
2025-11-29T20:18:33.997+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764433113997 | took 1ms | commit | connection 1119| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T20:18:34.043+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.SQL                        : 
    update
        reservation_service_request 
    set
        brand_id=?,
        car_id=?,
        model_id=?,
        reservation_date=?,
        reservation_status=?,
        reservation_time=?,
        service_id=?,
        user_id=? 
    where
        reservation_id=?
2025-11-29T20:18:34.045+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (1:BIGINT) <- [null]
2025-11-29T20:18:34.045+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (2:BIGINT) <- [null]
2025-11-29T20:18:34.045+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (3:BIGINT) <- [null]
2025-11-29T20:18:34.045+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (4:DATE) <- [2025-11-28]
2025-11-29T20:18:34.047+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (5:VARCHAR) <- [canceled]
2025-11-29T20:18:34.047+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (6:TIME) <- [12:00]
2025-11-29T20:18:34.048+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (7:BIGINT) <- [null]
2025-11-29T20:18:34.048+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (8:BIGINT) <- [1]
2025-11-29T20:18:34.048+04:00 TRACE 9392 --- [carservices] [http-nio-8081-exec-1] org.hibernate.orm.jdbc.bind              : binding parameter (9:BIGINT) <- [5]
2025-11-29T20:18:34.061+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764433114061 | took 8ms | statement | connection 1119| url jdbc:p6spy:postgresql://localhost:5433/testdb
update reservation_service_request set brand_id=?,car_id=?,model_id=?,reservation_date=?,reservation_status=?,reservation_time=?,service_id=?,user_id=? where reservation_id=?
update reservation_service_request set brand_id=NULL,car_id=NULL,model_id=NULL,reservation_date='2025-11-28T00:00:00.000+0400',reservation_status='canceled',reservation_time='1970-01-01T12:00:00.000+0400',service_id=NULL,user_id=1 where reservation_id=5;
2025-11-29T20:18:34.064+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-1] p6spy                                    : #1764433114064 | took 2ms | commit | connection 1119| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T20:33:55.682+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-6] org.hibernate.SQL                        : 
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)         AVG(re.stars) OVER (PARTITION 
    BY
        b.branch_id) AS avgStars     
    FROM
        branch b     
    LEFT JOIN
        branch_brand_service bbs 
            ON bbs.branch_id = b.branch_id     
    LEFT JOIN
        service_entity s 
            ON s.service_id = bbs.service_id     
    LEFT JOIN
        rate_experience re 
            ON re.branch_brand_serviceid = bbs.id     
    WHERE
        b.status = 'approved' 
        OR b.status = 'APPROVED'     
    ORDER BY
        b.branch_id 
2025-11-29T20:33:55.819+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-6] p6spy                                    : #1764434035819 | took 101ms | statement | connection 1122| url jdbc:p6spy:postgresql://localhost:5433/testdb
    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id

    SELECT
        b.branch_id        AS branchId,
        b.branch_name      AS branchName,
        b.logo_img         AS logoImg,
        b.branch_cover_img AS branchCoverImg,
        s.service_name     AS serviceName,
        -- NEW: average stars per branch (nullable if no ratings)
        AVG(re.stars) OVER (PARTITION BY b.branch_id) AS avgStars
    FROM branch b
    LEFT JOIN branch_brand_service bbs ON bbs.branch_id = b.branch_id
    LEFT JOIN service_entity s ON s.service_id = bbs.service_id
    LEFT JOIN rate_experience re ON re.branch_brand_serviceid = bbs.id
    WHERE b.status = 'approved' OR b.status = 'APPROVED'
    ORDER BY b.branch_id
;
2025-11-29T20:33:55.960+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-7] org.hibernate.SQL                        : 
    select
        c1_0.id,
        c1_0.city 
    from
        city c1_0
2025-11-29T20:33:55.960+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-2] org.hibernate.SQL                        : 
    select
        se1_0.service_id,
        se1_0.service_name,
        se1_0.service_type 
    from
        service_entity se1_0
2025-11-29T20:33:55.960+04:00 DEBUG 9392 --- [carservices] [http-nio-8081-exec-4] org.hibernate.SQL                        : 
    select
        b1_0.brand_id,
        b1_0.brand_name 
    from
        brand b1_0
2025-11-29T20:33:55.981+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764434035981 | took 19ms | statement | connection 1121| url jdbc:p6spy:postgresql://localhost:5433/testdb
select c1_0.id,c1_0.city from city c1_0
select c1_0.id,c1_0.city from city c1_0;
2025-11-29T20:33:55.981+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764434035981 | took 19ms | statement | connection 1119| url jdbc:p6spy:postgresql://localhost:5433/testdb
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0
select se1_0.service_id,se1_0.service_name,se1_0.service_type from service_entity se1_0;
2025-11-29T20:33:55.983+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764434035983 | took 21ms | statement | connection 1120| url jdbc:p6spy:postgresql://localhost:5433/testdb
select b1_0.brand_id,b1_0.brand_name from brand b1_0
select b1_0.brand_id,b1_0.brand_name from brand b1_0;
2025-11-29T20:33:56.007+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-7] p6spy                                    : #1764434036007 | took 1ms | commit | connection 1121| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T20:33:56.007+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-2] p6spy                                    : #1764434036007 | took 1ms | commit | connection 1119| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T20:33:56.007+04:00  INFO 9392 --- [carservices] [http-nio-8081-exec-4] p6spy                                    : #1764434036007 | took 1ms | commit | connection 1120| url jdbc:p6spy:postgresql://localhost:5433/testdb

;
2025-11-29T20:43:11.488+04:00  INFO 9392 --- [carservices] [File Watcher] rtingClassPathChangeChangedEventListener : Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2025-11-29T20:43:11.626+04:00  INFO 9392 --- [carservices] [Thread-42] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-29T20:43:11.681+04:00  INFO 9392 --- [carservices] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-11-29T20:43:11.750+04:00  INFO 9392 --- [carservices] [Thread-42] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-29T20:43:11.856+04:00  INFO 9392 --- [carservices] [Thread-42] com.zaxxer.hikari.HikariDataSource       : HikariPool-10 - Shutdown initiated...
2025-11-29T20:43:11.902+04:00  INFO 9392 --- [carservices] [Thread-42] com.zaxxer.hikari.HikariDataSource       : HikariPool-10 - Shutdown completed.
2025-11-29T20:43:13.534+04:00  INFO 9392 --- [carservices] [restartedMain] c.c.carservices.CarservicesApplication   : Starting CarservicesApplication using Java 21.0.7 with PID 9392 (C:\Grand BackUp\Sheikh-2\Private\Sheikhkashifiqbal\temp\Spare Parts Project\SpringBoot\car-dev-1\carservices\target\classes started by lenovo in C:\Grand BackUp\Sheikh-2\Private\Sheikhkashifiqbal\temp\Spare Parts Project\SpringBoot\car-dev-1\carservices)
2025-11-29T20:43:13.535+04:00  INFO 9392 --- [carservices] [restartedMain] c.c.carservices.CarservicesApplication   : No active profile set, falling back to 1 default profile: "default"
